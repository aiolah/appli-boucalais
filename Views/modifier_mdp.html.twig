{% extends "index.html.twig" %}

{% block section %}

<a href="?action=profil">← Mon profil</a>

<form method="post" action="?action=modifier-mdp" class="well">
    <fieldset>
    <legend>Changer votre mot de passe</legend><br/>
        <div class="form-group row">
            <label for="ancien-mdp" class="col-sm-2 col-form-label col-form-label-sm">Ancien mot de passe</label>
            <div class="col-sm-4">
                <input  type="password" id="ancien-mdp" class="form-control form-control-sm" name="ancien-mdp" required placeholder="" />
            </div>
        </div>
        <div class="form-group row">
            <label for="nouveau-mdp" class="col-sm-2 col-form-label col-form-label-sm">Nouveau mot de passe</label>
            <div class="col-sm-4 block">
                <input  type="password" id="nouveau-mdp" class="form-control form-control-sm" name="nouveau-mdp" required placeholder="" />
                <button id="bouton" class="open" title="Afficher le mot de passe"></button>
            </div>
        </div><br/>
        <input type="submit" name="modifier-mdp" class="bouton" value="Valider"/>
    </fieldset>
</form>

{% if succes == "oui" %}
    <p class="message green">{{ message }}</p>
{% elseif succes == "non" %}
    <p class="message red">{{ message }}</p>
{% endif %}

<script>

    // PreventDefault pour éviter un bug : quand on appuie sur la touche entrée, le bouton du mot de passe s'active.. Problème !
    let input1 = document.getElementsByTagName("input")[0];
    let input2 = document.getElementsByTagName("input")[1];
    input1.addEventListener("keypress", preventDefault);
    input2.addEventListener("keypress", preventDefault);
    function preventDefault(evt)
    {
        if(evt.keyCode == 13)
        {
            evt.preventDefault();
        }
    }

    // Bouton mot de passe
    let champ = document.getElementById("nouveau-mdp");
    let bouton = document.getElementById("bouton");
    bouton.addEventListener("click", affiche);

    // Au clic du bouton, on change le type du champs (password/text) et on rajoute/supprime la classe open et la classe closed (pour changer d'icône)
    function affiche(evt)
    {
        evt.preventDefault();
        if(bouton.className == "open")
        {
            champ.type = "text";
        }
        else
        {
            champ.type = "password";
        }
        bouton.classList.toggle("open");
        bouton.classList.toggle("closed");
    }

</script>

{% endblock %}