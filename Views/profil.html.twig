{% extends "index.html.twig" %}
{% block section %}

{% if message is defined and succes == "oui" %}
    <div class="alert alert-success" role="alert">{{message}}</div>
{% elseif message is defined and succes == "non" %}
    <div class="alert alert-danger" role="alert">{{message}}</div>
{% endif %}

<h2 class="mb-4">Mon profil</h2>

{% if user.dateInscription != "" %}
    {% if user.moyen == "Formulaire de demande de devis" %}
        <p><em>Demande de devis effectuée le {{ user.date|date('d/m/Y') }}
    {% elseif user.moyen != "Formulaire de demande de devis" %}
        <p><em>{{user.moyen}} le {{ user.date|date('d/m/Y') }}
    {% endif %}
    <br>Inscription sur l'application le {{user.dateInscription|date('d/m/Y')}}</em></p>
{% endif %}

{% if role == "prospect" %}
    <h3>Le groupe</h3>
    <div class="mb-4">
        <div>Nom du groupe : {{user.nomGroupe}}</div>
        <div>Type du groupe : {{user.typeGroupe}}</div>
    </div>

    <h3>Coordonnées du responsable (vous)</h3>
    <div class="mb-4">
        <div>Prénom : {{user.prenom}}</div>
        <div>Nom : {{user.nom}}</div>
        <div>Mail : {{user.mail}}</div>
        <div>Téléphone : {{user.telephone}}</div>
    </div>
{% elseif role == "gerant" %}
        <div>Prénom : {{user.prenom}}</div>
        <div>Nom : {{user.nom}}</div>
        <div>Mail : {{user.mail}}</div>
{% endif %}

<div>
    <a class="btn button-action" type="button" href="?action=modifier-profil">Modifier mon profil</a>
</div>
<div class="mt-3">
    <a class="btn button-action" type="button" href="?action=modifier-mdp">Modifier mon mot de passe</a>
</div>
<form method="post" action="?action=supprimer-compte" class="mt-3">
    <input type="submit" id="delete" name="supprimer-compte" class="btn button-suppression" type="button" value="Supprimer mon compte">
</form>

<script>

document.getElementById("delete").addEventListener("click", ohNo);
function ohNo(e)
{
    if("{{user.nomGroupe}}"  == "Les Fondus" || "{{user.nomGroupe}}"  == "Far West" || "{{user.mail}}"  == "nicole.bertrand@yopmail.com")
    {
        e.preventDefault();
    }
    else if(confirm("Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible et entraîne la suppression de toutes vos données ainsi que de vos devis."))
    {
        return;
    }
    else
    {
        e.preventDefault();
    }
}

if("{{user.nomGroupe}}"  == "Les Fondus" || "{{user.nomGroupe}}"  == "Far West" || "{{user.mail}}"  == "nicole.bertrand@yopmail.com")
{
    for(let a of document.getElementsByTagName('a'))
    {
        if(a.classList.contains('btn'))
        {
            a.addEventListener('click', inactive);
            a.href = '';
            a.style.cursor = "not-allowed";
        }
        document.getElementById("delete").style.cursor = "not-allowed";
    }

    function inactive(e)
    {
        e.preventDefault();
    }
}

</script>

{% endblock %}