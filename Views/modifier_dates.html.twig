{% extends "index.html.twig" %}
{% block section %}

{% if succes == "oui" %}
    <div class="alert alert-success" role="alert">{{message}}</div>
{% elseif succes == "non" %}
    <div class="alert alert-danger" role="alert">{{message}}</div>
{% endif %}

<div class="mb-3">
    <a href="?action=infos-reservation&reservation={{reservation.idReservation}}" class="mb-5">← Retour à la réservation</a>
</div>

<h3 class="mb-5">Modifier les dates de la réservation n°{{reservation.idReservation}}</h3>

<form method="post" action="?action=modifier-dates&reservation={{reservation.idReservation}}">
    <div class="form-group row">
        <label for="dateDebutReserv" class="col-lg-2 col-sm-4 col-form-label">Date de début</label>
        <div class="col-lg-4 col-sm-8">
            <input type="date" id="dateDebutReserv" name="DATE_DEBUT" class="form-control" value="{{reservation.dateDebut}}" required>
        </div>
    </div>
    <div class="form-group row">
        <label for="dateFinReserv" class="col-lg-2 col-sm-4 col-form-label">Date de fin</label>
        <div class="col-lg-4 col-sm-8">
            <input type="date" id="dateFinReserv" name="DATE_FIN" class="form-control" value="{{reservation.dateFin}}" required>
            <div id="date-dateFinReserv" class="invalid"></div>
        </div>
    </div>
    <input type="number" value="{{reservation.idReservation}}" name="idReservation" hidden>
    <input class="mt-3" type="submit" value="Enregistrer" name="modifier-dates">
</form>

<script>

let dateDebut = document.getElementById('dateDebutReserv');
let dateFin = document.getElementById('dateFinReserv');

// Détermination de la date minimum pour les champs input → date d'aujourd'hui
let today = new Date();
let month = today.getMonth() + 1;
if(month.toString().length == 1)
{
    month = "0" + month;
}
today = `${today.getFullYear()}-${month}-${today.getDate()}`;
dateDebut.setAttribute('min', today);
dateFin.setAttribute('min', today);

// LISTENERS
dateDebut.addEventListener("input", getNbreNuits);
dateFin.addEventListener("input", getNbreNuits);

// Détermine si les dates sélectionnées sont correctes
function getNbreNuits()
{
    // Calcul du nombre de nuits si les conditions sont bonnes
    if(dateDebut.value != "" && dateFin.value != "" && dateDebut.value.substring(0, 1) != 0 && dateFin.value.substring(0, 1) != 0)
    {
        let divDate = document.getElementById("date-" + dateFin.id);
        let dDateDebut = new Date(dateDebut.value);
        let dDateFin = new Date(dateFin.value);
        let nbreNuits = (dDateFin - dDateDebut)/1000/3600/24;
        if(nbreNuits < 0)
        {
            divDate.textContent = "La date de départ est inférieure à la date d'arrivée.";
            dateFin.classList.add('invalid-input');
        }
        else if(nbreNuits == 0)
        {
            divDate.textContent = "La date de départ est égale à la date d'arrivée.";
            dateFin.classList.add('invalid-input');
        }
        else
        {
            divDate.textContent = "";
            dateFin.classList.remove('invalid-input');
        }
    }
}

</script>

{% endblock %}